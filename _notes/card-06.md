---
layout: note
title: "Функция define()"
card_id: 006
date: 2025-09-16
card_type: theory # theory, technique, practice
categories: ["PHP Basics"]
difficulty: 1 # Уровень сложности (опционально)
icon: book # book, lightning-bolt, check-circle (соответствует типу)
question: |
  ```php
  define(string $constant_name, mixed $value, bool $case_insensitive = false): bool
  ```
  Расскажите об этой функции всё, что знаете.

short_answer: |
  `define()` создает **именованную константу**. Константы глобальны, неизменяемы и регистрозависимы. Могут содержать скаляры или массивы. Не используйте устаревший `case_insensitive`. Отличие от `const`: `define()` работает в runtime, `const` - в compile-time. Всегда называйте константы в **UPPER_CASE**.
---

### 1. Основное назначение и синтаксис

Функция `define()` используется для определения **именованных констант** во время выполнения.

```php
define(string $constant_name, mixed $value, bool $case_insensitive = false): bool
```

*   `$constant_name`: Имя константы (строка).
*   `$value`: Значение константы (скалярное значение или массив, объект — см. ниже).
*   `$case_insensitive`: Устаревший параметр. Если `true`, имя константы будет регистронезависимым. **Начиная с PHP 7.3, этот параметр объявлен устаревшим (deprecated), а с PHP 8.0.0 — удален.** Все константы по умолчанию регистро*зависимы*.
*   Возвращает `true` в случае успеха, `false` в случае ошибки (например, если константа уже определена).

**Базовый пример:**
```php
define('SITE_NAME', 'My Awesome Site');
echo SITE_NAME; // Выведет 'My Awesome Site'
```

---

### 2. Ключевые особенности и отличия от переменных

1.  **Область видимости (Scope):** Константы, объявленные через `define()`, являются **глобальными**. Это означает, что к ним можно получить доступ из любой области видимости (внутри функций, методов классов) без использования ключевого слова `global`.
    ```php
    define('TAX_RATE', 0.2);

    function calculateTax($amount) {
        // Не нужно использовать 'global'
        return $amount * TAX_RATE;
    }
    echo calculateTax(100); // 20
    ```

2.  **Соглашение об именовании:** По общепринятому соглашению имена констант пишутся **в верхнем регистре** через подчеркивание (например, `DB_HOST`, `API_VERSION`). Однако это не требование языка, а рекомендация.

3.  **Неизменяемость:** Значение константы **нельзя изменить** или удалить после определения. Попытка переопределить константу вызовет предупреждение (Warning), и значение останется прежним.
    ```php
    define('VERSION', '1.0');
    define('VERSION', '2.0'); // Warning: Constant VERSION already defined
    echo VERSION; // Останется '1.0'
    ```

4.  **Типы данных:** Константа может содержать данные только **скалярных типов** (`string`, `int`, `float`, `bool`) или **массив** (`array`). Попытка присвоить объект или ресурс вызовет предупреждение.
    ```php
    define('CONFIG', ['host' => 'localhost', 'port' => 3306]);
    echo CONFIG['host']; // 'localhost'

    // Начиная с PHP 7.0, можно использовать и массивы.
    ```

---

### 3. "Нестандартные" случаи и особенности

#### 1. Динамические имена констант

Имя константы можно формировать динамически, используя строки или конкатенацию. Для доступа к таким константам также используется синтаксис с константными выражениями.

```php
$statusCode = '404';
define('ERROR_' . $statusCode, 'Page Not Found'); // Определяем ERROR_404
echo constant('ERROR_' . $statusCode); // Используем constant() для доступа
// Выведет 'Page Not Found'
```
**Важно:** Нельзя использовать просто `ERROR_$statusCode`. Для доступа к константе по сформированному имени нужна функция `constant()`.

#### 2. Проверка существования константы

Перед определением константы хорошей практикой является проверка её существования с помощью функции `defined()`.

```php
if (!defined('APP_PATH')) {
    define('APP_PATH', dirname(__FILE__));
}
```
Это предотвращает предупреждения о повторном объявлении.

#### 3. Константы с зарезервированными именами

Можно создать константу с именем, которое совпадает с зарезервированным словом (например, `true`, `null`, `function`), но **это очень плохая практика** и крайне не рекомендуется, так как приводит к путанице и сложностям в отладке.

```php
define('true', 'This is confusing!'); // АНТИПАТТЕРН!
echo true; // Выведет 1, потому что true - это булево значение, а не наша константа!
echo constant('true'); // А так выведет 'This is confusing!'
```

#### 4. Магические константы vs define()

В PHP есть предопределенные **магические константы** (например, `__LINE__`, `__FILE__`, `__DIR__`). Их ключевое отличие в том, что их значение зависит от контекста и они меняются автоматически. Константы, созданные через `define()`, статичны.

#### 5. Сравнение с `const`

В PHP есть второй способ объявления констант — ключевое слово `const`.

| Характеристика | `define()` | `const` |
| :--- | :--- | :--- |
| **Время объявления** | Во время **выполнения** (runtime). | Во время **компиляции** (compile-time). Нельзя использовать внутри функций, циклов, условий. |
| **Регистронезависимость** | Была возможность (устарела). | Никогда не было. |
| **Значение** | Может быть любым выражением, даже другим `define()`. | Должно быть скалярным выражением или массивом, но не другим `const` или выражением с операторами (до PHP 5.6). |
| **Глобальная видимость** | Всегда глобальная. | В пределах неймспейса. Если объявлена в глобальной области — тоже глобальная. |

**Пример различий:**
```php
// define() - работает
if (true) {
    define('ALLOWED', true); // OK
}

// const - НЕ сработает
if (true) {
    const ALLOWED = true; // Ошибка: const не может быть использована в блоке if
}

// define() с выражением
define('SUM', 5 + 10); // OK

// const с выражением (работает только с PHP 5.6+)
const SUM = 5 + 10; // OK начиная с PHP 5.6
```

#### 6. Попытка использовать нескалярные значения (Объекты, Ресурсы)

При попытке определить константу с объектом или ресурсом в значении, PHP сгенерирует **Warning**. Однако начиная с PHP 7.0 можно использовать массивы (`array`).

```php
// Вызовет Warning: Constants may only evaluate to scalar values or arrays
define('RESOURCE', fopen('file.txt', 'r'));
define('OBJECT', new stdClass());
```

---

### 4. Best Practices

1.  **Всегда используйте `define()` для глобальных констант.**
2.  **Для проверки существования всегда используйте `defined()`.**
3.  **Имена констант — в верхнем регистре (`UPPER_CASE`) для читаемости.**
4.  **Избегайте устаревшего параметра `case_insensitive`.**
5.  **Не называйте константы в честь зарезервированных слов.**
6.  **Помните, что `const` имеет ограничения по месту объявления, в отличие от `define()`.**
7.  **Константы предназначены для неизменяемых значений, которые действительно являются постоянными в рамках приложения (настройки, пути, версии API).**

**Итог:** `define()` — это мощный инструмент для создания глобальных, неизменяемых значений в PHP. Понимание его особенностей, особенно времени выполнения, области видимости и отличий от `const`, является важным знанием для PHP-разработчика.
