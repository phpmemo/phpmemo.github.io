---
layout: note
title: "require — это языковая конструкция для включения и выполнения указанного файла в текущий скрипт"
card_id: 12
date: 2025-09-16
card_type: theory # theory, technique, practice
categories: ["PHP Basics"]
difficulty: 1 # Уровень сложности (опционально)
icon: book # book, lightning-bolt, check-circle (соответствует типу)
question: |
  Расскажите о языковой конструкции `require`.

short_answer: |
  `require` — жёсткое включение PHP-файла. При ошибке (нет файла) — фатальная ошибка (E_COMPILE_ERROR), скрипт останавливается.
  `require_once` исключает повторное подключение. Подключённый код наследует область видимости с места включения. 
  Может возвращать значение через `return`. Опасно использовать с пользовательским вводом (LFI-уязвимость).
---
### 1. Основное назначение

`require` — это языковая конструкция для включения и выполнения указанного файла в текущий скрипт. Это основной механизм для модуляции кода (подключения библиотек, шаблонов, компонентов).

```php
require 'config.php';
require 'path/to/functions.php';
```

### 2. Разница между `require` и `include`

Ключевое отличие — поведение при ошибке (когда файл не найден).

*   **`require`:** Вызывает **фатальную ошибку** (`E_COMPILE_ERROR`). Выполнение скрипта немедленно **прекращается**.
*   **`include`:** Выдает только **предупреждение** (`E_WARNING`). Скрипт продолжит выполнение.

Выбор зависит от критичности файла:
*   `require` — для обязательных файлов (настройки, основные функции).
*   `include` — для необязательных частей (шаблоны, блоки, которые могут отсутствовать).

### 3. `require_once`

Вариант `require_once` проверяет, не был ли уже подключен данный файл ранее. Если был — повторное подключение не происходит. Это предотвращает ошибки переопределения функций, классов или переменных.

```php
require_once 'vendor/autoload.php'; // Подключится только один раз
require_once 'vendor/autoload.php'; // Этот вызов будет проигнорирован
```

### 4. Особенности и важные детали

1.  **Область видимости (Scope):** Переменные, объявленные в подключаемом файле, наследуют область видимости той строки, где вызван `require`. Если `require` используется внутри функции, переменные из файла будут видны только в этой функции.
    ```php
    // config.php: <?php $config = ['key' => 'value'];
    function loadConfig() {
        require 'config.php';
        echo $config['key']; // Работает
    }
    loadConfig();
    echo $config['key']; // Ошибка! $config не видна здесь.
    ```

2.  **Возврат значений:** `require` — это не функция, а языковая конструкция. Поэтому скобки не обязательны. Файл может возвращать значение с помощью `return`.
    ```php
    // data.php: <?php return ['db_host' => 'localhost'];
    $config = require 'data.php'; // Переменная $config получит массив
    ```

3.  **Пути к файлам:** PHP ищет файл сначала в текущей рабочей директории (часто это директория запущенного скрипта), а затем в директориях из `include_path`. Лучше использовать абсолютные пути с `__DIR__` для избежания путаницы.
    ```php
    require __DIR__ . '/includes/file.php'; // Надежный абсолютный путь
    ```

4.  **Парсинг:** PHP парсит файл только если он имеет подходящее расширение (обычно `.php`). Если подключить файл с другим расширением (например, `.html`), его содержимое будет выведено как текст. Это можно использовать для шаблонов.
    ```php
    require 'template.html'; // Содержимое HTML будет выведено
    ```

5.  **Безопасность:** Динамическое подключение файлов на основе пользовательского ввода (например, `require $_GET['page'] . '.php';`) **крайне опасно** (уязвимость LFI - Local File Inclusion). Путь должен быть жестко контролируемым или валидироваться.

### 5. Рекомендации по использованию

*   Для критически важных файлов всегда используйте `require` или `require_once`.
*   Используйте `require_once` для подключения файлов с классами и функциями во избежание конфликтов.
*   Для лучшей производительности в продакшене используйте автозагрузчик Composer (`vendor/autoload.php`) вместо множественных `require`.
*   Для безопасности избегайте динамических путей в `require` или строго их проверяйте.

### Итог:

`require` — инструкция для жесткого включения файла. При ошибке (файл не найден) вызывает фатальную ошибку и останавливает выполнение. `require_once` предотвращает множественное включение. Подключенный код наследует область видимости. Может возвращать значение. Динамическое использование опасно (LFI).
